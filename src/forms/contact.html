<!DOCTYPE html>
<html>
  <head>
    <title>Histo Atlas - Contact</title>
    <link rel="icon" type="image/png" href="img/icon_map.png" />
  </head>
  <body>

  <script type="text/javascript" src="../node_modules/jquery/dist/jquery.min.js"></script>

  <link rel="stylesheet" href="../index.css" />

  <p><a href="../index.html">Retour au menu</a></p>

  <h3>Contact</h3>
  <p>Envoyé un mail pour remonter un bug, une suggestion ou un avis.</p>
  <label for="mail">Votre Mail : </label><input id="mail" type="text" style="width: 250px;"></input><br/><br/>
  <label for="name">Nom ou pseudo : </label><input id="name" type="text" style="width: 500px;"></input><br/><br/>
  <label for="title">Titre : </label><input id="title" type="text" style="width: 500px;"></input><br/><br/>
  <label for="message">Message : </label><textarea id="message" name="message" rows="22" cols="80"></textarea><br/><br/>
  <button id="sendButton">Envoyer</button>

  <script type="text/javascript" src="../config/config.js"></script>

  <script>

    Config.load(true).then((config) =>
    {
      function validateEmail(email) 
      {
        const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
      }

      $("#sendButton").click(function() 
      {
        let mail = $("#mail").val();
        let message = $("#message").val();
        let title = $("#title").val();
        let name = $("#name").val();

        if(mail.length == 0)
        {
          alert("Mail vide");
        }
        else if(!validateEmail(mail))
        {
          alert("Adresse mail invalide");
        }
        else if(message.length == 0)
        {
          alert("Message vide")
        }
        else if(name.length == 0)
        {
          alert("Nom ou pseudo vide")
        }
        else if(title.length == 0)
        {
          alert("Titre vide")
        }
        else
        {
          let urlServer = config.serverUrl + "/api/user/mail";

          $.ajax({
            url: urlServer,
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({name : name, message : message, title : title, mail : mail}),
            success: (response) => {

              alert("Message Envoyé");
              window.location.href = "../index.html";
            },
            error: (err) => {
              alert("Echec de l'envoit du mail");

            }
          });
        }
      });
    });

  </script>

  </body>
</html>